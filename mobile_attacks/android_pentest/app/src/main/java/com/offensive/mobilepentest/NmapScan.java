package com.offensive.mobilepentest;

import java.util.ArrayList;
import java.util.List;

/**
 * Represents the results of an Nmap scan
 */
public class NmapScan {
    private List<NmapHost> hosts;
    private long startTime;
    private long endTime;
    private long scanTime;
    
    public NmapScan() {
        this.hosts = new ArrayList<>();
        this.startTime = System.currentTimeMillis();
    }
    
    public void addHost(NmapHost host) {
        hosts.add(host);
    }
    
    public List<NmapHost> getHosts() {
        return hosts;
    }
    
    public void finish() {
        this.endTime = System.currentTimeMillis();
        this.scanTime = endTime - startTime;
    }
    
    public void setScanTime(long scanTime) {
        this.scanTime = scanTime;
    }
    
    public long getScanTime() {
        return scanTime;
    }
    
    public long getDuration() {
        return endTime - startTime;
    }
    
    public int getTotalOpenPorts() {
        int count = 0;
        for (NmapHost host : hosts) {
            for (NmapPort port : host.getPorts()) {
                if (port.isOpen()) count++;
            }
        }
        return count;
    }
    
    public int getHostCount() {
        return hosts.size();
    }
    
    @Override
    public String toString() {
        StringBuilder sb = new StringBuilder();
        sb.append("Nmap Scan Results\n");
        sb.append("=================\n");
        sb.append("Scan time: ").append(scanTime).append("ms\n");
        
        for (NmapHost host : hosts) {
            sb.append("\nHost: ").append(host.getAddress());
            if (host.getHostname() != null) {
                sb.append(" (").append(host.getHostname()).append(")");
            }
            sb.append("\n");
            for (NmapPort port : host.getPorts()) {
                if (port.isOpen()) {
                    sb.append("  ").append(port.getPort()).append("/").append(port.getProtocol());
                    sb.append(" - ").append(port.getService());
                    if (port.getBanner() != null) {
                        sb.append(" (").append(port.getBanner().substring(0, 
                            Math.min(50, port.getBanner().length()))).append(")");
                    }
                    sb.append("\n");
                }
            }
        }
        
        return sb.toString();
    }
}
