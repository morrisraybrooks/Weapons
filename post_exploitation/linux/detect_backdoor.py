#!/usr/bin/env python3
import hashlib
import difflib

def get_file_hash(filepath):
    sha256 = hashlib.sha256()
    with open(filepath, "rb") as f:
        while chunk := f.read(8192):
            sha256.update(chunk)
    return sha256.hexdigest()

def detect_backdoor(original, modified):
    orig_hash = get_file_hash(original)
    mod_hash = get_file_hash(modified)
    
    if orig_hash != mod_hash:
        print("⚠️ BACKDOOR DETECTED!")
        print(f"Original hash: {orig_hash}")
        print(f"Modified hash: {mod_hash}")
        
        with open(original, "r") as f1, open(modified, "r") as f2:
            diff = difflib.unified_diff(
                f1.readlines(),
                f2.readlines(),
                fromfile=original,
                tofile=modified,
            )
            print("\nDifferences:")
            print("\033[91m" + "".join(diff) + "\033[0m")
        return True
    else:
        print("✅ No modifications detected")
        return False

if __name__ == "__main__":
    detect_backdoor("original_tool.py", "backdoored_tool.py")
