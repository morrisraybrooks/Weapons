/*
 * USB Hacker - Android Proof-of-Concept
 * Author: Agent Zero
 * Date: 2026-01-20
 * Description: USB attack vector demonstration
 *
 * WARNING: For authorized security research only
 * Unauthorized use against systems you don't own is illegal
 */

package com.offsec.usbhacker;

import android.app.Activity;
import android.content.Context;
import android.hardware.usb.UsbManager;
import android.hardware.usb.UsbDevice;
import android.hardware.usb.UsbDeviceConnection;
import android.hardware.usb.UsbInterface;
import android.hardware.usb.UsbEndpoint;
import android.hardware.usb.UsbConstants;
import android.os.Bundle;
import android.widget.TextView;
import android.widget.Button;
import android.view.View;
import java.util.HashMap;
import java.util.Iterator;

public class USBHackerApp extends Activity {
    private UsbManager usbManager;
    private TextView statusView;
    private TextView deviceInfo;
    private Button scanButton;
    private Button exploitButton;
    
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        
        // Initialize UI components
        statusView = findViewById(R.id.statusView);
        deviceInfo = findViewById(R.id.deviceInfo);
        scanButton = findViewById(R.id.scanButton);
        exploitButton = findViewById(R.id.exploitButton);
        
        // Initialize USB manager
        usbManager = (UsbManager) getSystemService(Context.USB_SERVICE);
        
        // Set up scan button
        scanButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                scanUSBDevices();
            }
        });
        
        // Set up exploit button (disabled by default)
        exploitButton.setEnabled(false);
        exploitButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                executeUSBExploit();
            }
        });
    }
    
    private void scanUSBDevices() {
        statusView.setText("Scanning USB devices...");
        
        HashMap<String, UsbDevice> deviceList = usbManager.getDeviceList();
        Iterator<UsbDevice> deviceIterator = deviceList.values().iterator();
        
        if (deviceList.isEmpty()) {
            deviceInfo.setText("No USB devices found");
            statusView.setText("Scan complete");
            return;
        }
        
        StringBuilder deviceInfoText = new StringBuilder();
        
        while (deviceIterator.hasNext()) {
            UsbDevice device = deviceIterator.next();
            deviceInfoText.append("Device: ").append(device.getDeviceName()).append("\n");
            deviceInfoText.append("Vendor ID: ").append(device.getVendorId()).append("\n");
            deviceInfoText.append("Product ID: ").append(device.getProductId()).append("\n");
            deviceInfoText.append("Interfaces: ").append(device.getInterfaceCount()).append("\n\n");
            
            // Enable exploit button if we find potential targets
            if (device.getVendorId() == 0x18d1 ||  // Google
                device.getVendorId() == 0x04e8 ||  // Samsung
                device.getVendorId() == 0x045e) {  // Microsoft
                exploitButton.setEnabled(true);
            }
        }
        
        deviceInfo.setText(deviceInfoText.toString());
        statusView.setText("Scan complete - " + deviceList.size() + " devices found");
    }
    
    private void executeUSBExploit() {
        statusView.setText("Executing USB exploit...");
        
        // This is a proof-of-concept demonstration
        // In a real attack, this would attempt to exploit USB vulnerabilities
        
        new Thread(new Runnable() {
            @Override
            public void run() {
                try {
                    // Simulate exploit process
                    Thread.sleep(2000);
                    
                    runOnUiThread(new Runnable() {
                        @Override
                        public void run() {
                            statusView.setText("Exploit simulation complete");
                            deviceInfo.append("\n[+] Proof-of-concept executed\n");
                            deviceInfo.append("[+] Would attempt to open terminal session\n");
                            deviceInfo.append("[+] Would execute commands on host system\n");
                        }
                    });
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }).start();
    }
}
